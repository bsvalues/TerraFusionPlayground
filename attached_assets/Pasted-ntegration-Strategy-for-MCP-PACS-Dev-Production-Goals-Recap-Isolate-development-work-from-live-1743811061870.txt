ntegration Strategy for MCP-PACS Dev & Production
ğŸ¯ Goals Recap:
Isolate development work from live pacs_oltp

Enable safe import/export flows

Keep both inbound and outbound clean (staging, transformations, logs)

Align with existing PACS workflows and avoid accidental writes

ğŸ“ Recommended Architecture
rust
Copy
Edit
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   External   â”‚         â”‚    MCP Tools (API) â”‚
              â”‚   Systems    â”‚â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚  e.g., get_parcel, â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  route_appeal, ... â”‚
                    â–²                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                               â”‚
                    â”‚                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Export Stg â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  pacs_training â”‚
              â”‚ (e.g., CSV â”‚    direct dev     â”‚ (acts as oltp) â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â†•ï¸ access       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 for dev only

ğŸ§ª Development Environment Configuration
Current Working Database:

Server: jcharrispacs

Dev DB: pacs_training

Production DB (eventual target): pacs_oltp

ğŸ§³ Staging Strategy
1. import_staging Tables
For importing data (e.g. mass exemption uploads, OCR records):

sql
Copy
Edit
-- Schema: pacs_training.dbo.import_staging_property_values
CREATE TABLE import_staging_property_values (
  import_id INT IDENTITY(1,1),
  parcel_id VARCHAR(20),
  value_type VARCHAR(50),
  value_amount DECIMAL(18,2),
  effective_date DATE,
  source VARCHAR(255),
  created_at DATETIME DEFAULT GETDATE()
);
2. export_snapshots Tables
Used for:

Exporting appraiser job runs

Archiving MCP output

Manual QA before real PACS insertions

sql
Copy
Edit
-- Schema: pacs_training.dbo.export_snapshot_parcel_timeline
CREATE TABLE export_snapshot_parcel_timeline (
  snapshot_id UNIQUEIDENTIFIER DEFAULT NEWID(),
  parcel_id VARCHAR(20),
  year INT,
  value DECIMAL(18,2),
  extracted_by VARCHAR(50),
  exported_at DATETIME DEFAULT GETDATE()
);
âš™ï¸ Dev Workflow
Local Dev / MCP Testing
All reads/writes go to pacs_training

Export snapshots pulled from pacs_training â†’ staging for validation

Export templates generated by /tools/export_* endpoints

Production Import (Later)
Final data is validated and staged

Manual or automated QA sign-off step

Separate job migrates to pacs_oltp only if QA passed

ğŸ”’ Safety Controls (Highly Recommended)
Enforce readonly default access to pacs_oltp

Use parameterized stored procedures only in prod

Log who triggers what export/import, even during dev

Mask or omit sensitive fields when exporting for QA

âœ… Example MCP Integration Tool (Staging-Aware)
python
Copy
Edit
@app.post("/tools/validate_exemption_upload")
def validate_exemption_upload(file: UploadFile, db: Session = Depends(get_dev_training_db)):
    """
    Load a CSV file into pacs_training.import_staging_exemptions and validate records.
    """
    raw_data = parse_csv_to_dataframe(file)
    staged = stage_exemptions(raw_data, db)  # Writes to pacs_training.dbo.import_staging_exemptions
    errors = run_exemption_validations(staged)
    return {"staged_count": len(staged), "errors": errors}
ğŸ§­ Next Steps
âœ… Create staging + snapshot table schemas (I'll scaffold them for you if you want!)

âœ… Point all dev tooling to pacs_training

ğŸ”„ Automate snapshot exports via /tools/export_parcel_snapshot

ğŸ§ª Add a /tools/validate_import endpoint for QA pre-load checks

ğŸ’¾ Version and log every PACS-importable file or script

Would you like me to:

Scaffold the FastAPI endpoints for this export/import toolchain?

Generate the SQL to create these staging/snapshot tables in pacs_training?

Add CLI tooling for snapshot diffing and QA logs?

Letâ€™s build it the right way â€” audit-first and future-proof.